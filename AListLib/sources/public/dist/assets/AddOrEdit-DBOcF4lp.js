import{k as I,bV as C,b7 as h,bq as u,E as e,a7 as S,c1 as v,q as w,S as m,bR as i,bE as l,bo as f,V as c,c0 as F,G as q,aO as E,ba as p,a8 as T,bt as g,x as D,W as L,dd as M,af as P}from"./index-Bl5KfUKm.js";import{a as U}from"./FolderTree-CHsUuiQU.js";import{P as R}from"./PublicKeys-CHL4Weir.js";import"./index-C_xnhf0Z.js";const V=t=>{const d=w();return e(i,{display:"inline-flex",flexDirection:"row",alignItems:"center",gap:"$2",rounded:"$md",shadow:"$md",p:"$2",w:"fit-content",get children(){return[e(l,{mb:"0",get children(){return d("users.permissions.".concat(t.name))}}),e(p,{get checked(){return t.can},onChange:()=>t.onChange(!t.can)})]}})},H=()=>{const t=w(),{params:d,back:b}=I(),{id:a}=d,[n,s]=C({id:0,username:"",password:"",base_path:"",role:0,permission:0,disabled:!1,sso_id:"",allow_ldap:!1}),[$,x]=h(()=>u.get("/admin/user/get?id=".concat(a)));a&&(async()=>{const r=await x();g(r,s)})();const[y,_]=h(()=>u.post("/admin/user/".concat(a?"update":"create"),n));return e(P,{get loading(){return $()},get children(){return e(S,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[e(v,{get children(){return t("global.".concat(a?"edit":"add"))}}),e(m,{get when(){return!c.is_guest(n)},get children(){return[e(i,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(l,{for:"username",display:"flex",alignItems:"center",get children(){return t("users.username")}}),e(f,{id:"username",get value(){return n.username},onInput:r=>s("username",r.currentTarget.value)})]}}),e(i,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(l,{for:"password",display:"flex",alignItems:"center",get children(){return t("users.password")}}),e(f,{id:"password",type:"password",placeholder:"********",get value(){return n.password},onInput:r=>s("password",r.currentTarget.value)})]}})]}}),e(i,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(l,{for:"base_path",display:"flex",alignItems:"center",get children(){return t("users.base_path")}}),e(U,{id:"base_path",get value(){return n.base_path},onChange:r=>s("base_path",r),onlyFolder:!0})]}}),e(i,{w:"$full",required:!0,get children(){return[e(l,{display:"flex",alignItems:"center",get children(){return t("users.permission")}}),e(F,{w:"$full",wrap:"wrap",gap:"$2",get children(){return e(q,{each:E,children:(r,o)=>e(V,{name:r,get can(){return c.can(n,o())},onChange:k=>{k?s("permission",n.permission|=1<<o()):s("permission",n.permission&=~(1<<o()))}})})}})]}}),e(i,{w:"fit-content",display:"flex",get children(){return e(p,{css:{whiteSpace:"nowrap"},id:"disabled",onChange:r=>s("disabled",r.currentTarget.checked),color:"$neutral10",fontSize:"$sm",get checked(){return n.disabled},get children(){return t("users.disabled")}})}}),e(i,{w:"fit-content",display:"flex",get children(){return e(p,{css:{whiteSpace:"nowrap"},id:"allow_ldap",onChange:r=>s("allow_ldap",r.currentTarget.checked),color:"$neutral10",fontSize:"$sm",get checked(){return n.allow_ldap},get children(){return t("users.allow_ldap")}})}}),e(T,{get loading(){return y()},onClick:async()=>{const r=await _();g(r,async()=>{D.success(t("global.save_success")),n.username===L().username&&g(await u.get("/me"),M),b()})},get children(){return t("global.".concat(a?"save":"add"))}}),e(m,{get when(){return a&&!c.is_guest(n)},get children(){return e(R,{isMine:!1,get userId(){return parseInt(a)}})}})]}})}})};export{H as default};
