System.register(["./index-legacy-BzvznpU_.js","./ModalInput-legacy-Cw9-SN51.js","./item_type-legacy-BFH7Oxl9.js","./ResponsiveGrid-legacy-Bs3dvwiZ.js"],function(e,r){"use strict";var t,n,a,o,i,u,d,g,l,s,c,m,p,h,v,y,f,b,w,$,C,S,_,x,k,O,N,T,F,I,J,j,q,B,R,E,G;return{setters:[e=>{t=e.E,n=e.bE,a=e.q,o=e.Z,i=e.$,u=e.bo,d=e.bQ,g=e.bW,l=e.bF,s=e.bX,c=e.a1,m=e.aJ,p=e.S,h=e.df,v=e.bR,y=e.k,f=e.b7,b=e.bq,w=e.X,$=e.bV,C=e.C,S=e.c1,_=e.a7,x=e.dJ,k=e.dg,O=e.dh,N=e.G,T=e.F,F=e.ao,I=e.a8,J=e.x,j=e.L,q=e.bt,B=e.af},e=>{R=e.M},e=>{E=e.T},e=>{G=e.R}],execute:function(){const r=e=>{const r=a(),y=e=>"function"==typeof e?e():e;return t(v,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(n,{get for(){return e.name},display:"flex",alignItems:"center",get children(){return r(e.full_name_path??"common"===e.driver?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),t(o,{get fallback(){return t(m,{get children(){return r("settings.unknown_type")}})},get children(){return[t(i,{get when(){return e.type===E.String},get children(){return t(u,{get id(){return e.name},get type(){return"password"==e.name?"password":"text"},get readOnly(){return e.readonly},get value(){return y(e.value)},get onChange(){return e.type===E.String?r=>e.onChange?.(r.currentTarget.value):void 0}})}}),t(i,{get when(){return e.type===E.Number},get children(){return t(u,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return y(e.value)},get onInput(){return e.type===E.Number?r=>e.onChange?.(parseInt(r.currentTarget.value)):void 0}})}}),t(i,{get when(){return e.type===E.Float},get children(){return t(u,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return y(e.value)},get onInput(){return e.type===E.Float?r=>e.onChange?.(parseFloat(r.currentTarget.value)):void 0}})}}),t(i,{get when(){return e.type===E.Bool},get children(){return t(d,{get id(){return e.name},get readOnly(){return e.readonly},get checked(){return y(e.value)},get onChange(){return e.type===E.Bool?r=>e.onChange?.(r.currentTarget.checked):void 0}})}}),t(i,{get when(){return e.type===E.Text},get children(){return t(g,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return y(e.value)},get onChange(){return e.type===E.Text?r=>e.onChange?.(r.currentTarget.value):void 0}})}}),t(i,{get when(){return e.type===E.Select},get children(){return t(l,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return y(e.value)},get onChange(){return e.type===E.Select?r=>e.onChange?.(r):void 0},get children(){return t(s,{get readonly(){return e.readonly},get searchable(){return c(()=>e.type===E.Select)()&&e.searchable},get options(){return e.options.split(",").map(t=>({key:t,label:r((e.options_prefix??("common"===e.driver?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`))+`.${t}`)}))}})}})}})]}}),t(p,{get when(){return e.help},get children(){return t(h,{get children(){return r("common"===e.driver?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})};function M(e,r){switch(e){case E.Bool:return!!r&&"true"===r;case E.Number:return r?parseInt(r):0;case E.Float:return r?parseFloat(r):0;default:return r||""}}e("default",()=>{const e=a(),{params:n,back:o,to:i}=y(),{id:u}=n,[d,g]=f(()=>b.get("/admin/driver/list"),!0),[l,s]=w({}),[m,h]=f(()=>b.get(`/admin/storage/get?id=${u}`),!0),[v,V]=f(()=>b.get(`/admin/driver/info?driver=${X.driver}`),!0);u?(async()=>{const e=await h();q(e,async e=>{D(e),Q(JSON.parse(e.addition));const r=await V();q(r,e=>s({[X.driver]:e}))})})():(async()=>{const e=await g();q(e,s)})();const[X,D]=$({}),[L,Q]=$({}),[W,Z]=f(()=>(D("addition",JSON.stringify(L)),b.post("/admin/storage/"+(u?"update":"create"),X))),z=C(()=>{const e=l()[X.driver]?.config.alert;if(console.log(e),e)return e.split("|")[0]}),[A,H]=w(!1),[K,P]=w(!1);return t(B,{get loading(){return u?m()||v():d()},get children(){return[t(S,{mb:"$2",get children(){return e("global."+(u?"edit":"add"))}}),t(_,{mb:"$2",spacing:"$2",get children(){return[t(r,{name:"driver",default:"",readonly:void 0!==u,required:!0,searchable:!0,get type(){return E.Select},get options(){return u?X.driver:Object.keys(l()).join(",")},get value(){return X.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:e=>{for(const r of l()[e].common)D(r.name,M(r.type,r.default));Q(x(e=>{for(const r in e)delete e[r]}));for(const r of l()[e].additional)Q(r.name,M(r.type,r.default));D("driver",e)}}),t(p,{get when(){return z()},get children(){return t(k,{get status(){return z()},w:"$full",get children(){return[t(O,{}),c(()=>e(`drivers.config.${X.driver}.alert`))]}})}})]}}),t(G,{get children(){return t(p,{get when(){return l()[X.driver]},get children(){return[t(N,{get each(){return l()[X.driver].common},children:e=>t(r,T(e,{driver:"common",get value(){return X[e.name]},onChange:r=>{D(e.name,r)}}))}),t(N,{get each(){return l()[X.driver].additional},children:e=>t(r,T(e,{get driver(){return X.driver},get value(){return L[e.name]},onChange:r=>{Q(e.name,r)}}))})]}})}}),t(F,{mt:"$2",spacing:"$2",gap:"$2",w:"$full",wrap:{"@initial":"wrap","@md":"unset"},get children(){return[t(I,{get loading(){return W()},onClick:async()=>{l()[X.driver].config.need_ms&&(J.info(e("manage.add_storage-tips")),window.open(j("/@manage/messenger"),"_blank"));const r=await Z();q(r,()=>{J.success(e("global.save_success")),o()},(e,t)=>{r.data.id&&i(`/@manage/storages/edit/${r.data.id}`)})},get children(){return e("global."+(u?"save":"add"))}}),t(I,{colorScheme:"accent",get loading(){return W()},onClick:async()=>{H(!0)},get children(){return e("storages.common.export")}}),t(I,{colorScheme:"primary",get loading(){return W()},onClick:async()=>{P(!0)},get children(){return e("storages.common.import")}})]}}),t(p,{get when(){return A()},get children(){return t(R,{get opened(){return A()},onClose:()=>H(!1),get title(){return e("storages.common.export_title")},type:"text",get tips(){return e("storages.common.export_tips")},get defaultValue(){return JSON.stringify(X)},onSubmit:()=>{H(!1)}})}}),t(R,{get opened(){return K()},onClose:()=>P(!1),get title(){return e("storages.common.import_title")},type:"text",get tips(){return e("storages.common.import_tips")},onSubmit:r=>{try{const{id:t,disabled:n,modified:a,status:o,...i}=JSON.parse(r);D(i),Q(JSON.parse(i.addition)),P(!1),J.success(e("storages.common.import_success"))}catch(t){J.error(`Invalid storage format: ${t.message}`)}}})]}})})}}});
