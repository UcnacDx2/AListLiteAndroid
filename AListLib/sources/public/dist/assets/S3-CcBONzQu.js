import{E as t,bR as p,bE as y,q as b,bo as F,cA as _,a8 as g,G as B,F as C,a7 as $,b7 as w,bq as u,bV as D,dk as N,X as R,dl as q,S as G,bt as k,x as d,c1 as J,ao as K,dm as L,dn as O}from"./index-Bl5KfUKm.js";import{b as T}from"./useTitle-COa73MJx.js";import{G as W}from"./index-CSLMu7OW.js";import{I as E}from"./SettingItem-BYHwCQXr.js";import{R as H}from"./ResponsiveGrid-BWMI6qdJ.js";import{a as V}from"./FolderTree-CHsUuiQU.js";import{c as m}from"./index-fAEGil0n.js";import"./index-C_xnhf0Z.js";import"./index-S6P6XS8L.js";import"./item_type-CyD6qwPS.js";const X=e=>{const s=b();return t(_,{w:"$full",overflowX:"auto",shadow:"$md",rounded:"$lg",p:"$2",direction:{"@initial":"column","@xl":"row"},spacing:"$2",get children(){return[t(p,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[t(y,{for:"path",display:"flex",alignItems:"center",get children(){return s("global.name")}}),t(F,{id:"name",get value(){return e.name},onChange:n=>e.onChange({...e,name:n.currentTarget.value})})]}}),t(p,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[t(y,{for:"path",display:"flex",alignItems:"center",get children(){return s("metas.path")}}),t(V,{id:"path",get value(){return e.path},onChange:n=>e.onChange({...e,path:n})})]}}),t(_,{direction:{"@initial":"row","@xl":"column"},justifyContent:{"@xl":"center"},spacing:"$1",get children(){return t(g,{colorScheme:"danger",onClick:async()=>{e.onDelete()},get children(){return s("global.delete")}})}})]}})},j=e=>{const s=b();return console.log(e.buckets),t($,{alignItems:"start",w:"$full",get children(){return[t(y,{display:"flex",alignItems:"center",get children(){return s("settings.s3_buckets")}}),t(g,{onClick:()=>{e.setSettings(n=>n.key==="s3_buckets","value",JSON.stringify([...e.buckets,{name:"",path:""}])),console.log(e.buckets)},get children(){return s("global.add")}}),t(B,{get each(){return e.buckets},children:n=>t(X,C(n,{onChange:a=>{console.log(a),e.setSettings(r=>r.key==="s3_buckets","value",JSON.stringify(e.buckets.map(r=>r.name===n.name?a:r)))},onDelete:()=>{e.setSettings(a=>a.key==="s3_buckets","value",JSON.stringify(e.buckets.filter(a=>a.name!==n.name)))}}))})]}})},v=e=>{const s={...e.find(n=>n.key==="s3_buckets")};return s.value?JSON.parse(s.value):[]},se=()=>{const e=b();T("manage.sidemenu.s3");const[s,n]=w(()=>u.get("/admin/setting/list?group=".concat(W.S3))),[a,r]=D([]),h=async()=>{const c=await n();k(c,r)};h();const[x,I]=w(()=>u.post("/admin/setting/save",N(a))),[A,S]=R(!1);return t($,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[t(H,{get children(){return[t(q,{each:a,children:(c,o)=>t(G,{get when(){return c().key!="s3_buckets"},get children(){return t(E,C(c,{onChange:l=>{r(i=>c().key===i.key,"value",l)},onDelete:async()=>{S(!0);const l=await u.post("/admin/setting/delete?key=".concat(c().key));S(!1),k(l,()=>{d.success(e("global.delete_success")),h()})}}))}})}),t(g,{onClick:()=>{const c=m.lib.WordArray.random(15),o=m.lib.WordArray.random(240/8),l=m.enc.Base64.stringify(c).replace(/[\r\n]/g,""),i=m.enc.Base64.stringify(o).replace(/[\r\n]/g,"");r(f=>f.key==="s3_access_key_id","value",l),r(f=>f.key==="s3_secret_access_key","value",i)},get children(){return e("settings.s3_generate")}}),t(J,{get children(){return e("settings.s3_restart_to_apply")}}),t(j,{get buckets(){return v(a)},setSettings:r})]}}),t(K,{spacing:"$2",get children(){return[t(g,{colorScheme:"accent",onClick:h,get loading(){return s()||A()},get children(){return e("global.refresh")}}),t(g,{get loading(){return x()},onClick:async()=>{const c=v(a),o=new Set;for(const i of c){if(i.name===""||i.path===""){d.error(e("settings.s3_buckets_empty"));return}if(o.has(i.name)){d.error(e("settings.s3_buckets_duplicate_name"));return}o.add(i.name)}const l=await I();k(l,async()=>{d.success(e("global.save_success")),L(await u.get("/public/settings"),O)})},get children(){return e("global.save")}})]}})]}})};export{se as default};
