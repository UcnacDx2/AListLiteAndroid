import{aQ as P,E as t,bo as z,q as M,S as g,a8 as C,ao as S,aR as E,aS as B,bu as Z,aT as H,aU as N,aW as V,aX as D,X as b,dK as p,ae as y,T as v,a1 as I,bU as ee,dL as te,b7 as R,dM as ne,_ as re,dN as ae,aa as oe,aE as w,aw as $,dO as A,a6 as le,o as ce,N as ie,a7 as ue,G as de,A as U,bt as se,bg as ge,al as he,bp as fe,x as me,b9 as Ce}from"./index-Bl5KfUKm.js";import{o as be,E as W,G as we,H as $e}from"./index-C_xnhf0Z.js";const X=p(),L=e=>{var o;const[l,a]=b("/"),[c,n]=b(null),d=()=>{n(l())};return(o=e.handle)==null||o.call(e,{setPath:a,startCreateFolder:d}),t(y,{class:"folder-tree-box",w:"$full",overflowX:"auto",get children(){return t(X.Provider,{get value(){var i,r,u,h;return{value:l,onChange:f=>{a(f),e.onChange(f)},autoOpen:(i=e.autoOpen)!=null?i:!1,forceRoot:(r=e.forceRoot)!=null?r:!1,showEmptyIcon:(u=e.showEmptyIcon)!=null?u:!1,showHiddenFolder:(h=e.showHiddenFolder)!=null?h:!0,creatingFolderPath:c,setCreatingFolderPath:n}},get children(){return t(j,{path:"/"})}})}})},j=e=>{const{isHidePath:l}=ee(),[a,c]=b(),{value:n,onChange:d,forceRoot:o,autoOpen:i,showEmptyIcon:r,showHiddenFolder:u,creatingFolderPath:h,setCreatingFolderPath:f}=te(X),G=()=>{var s;return!!(r&&a()!==void 0&&!((s=a())!=null&&s.length))},[K,q]=R(()=>ne(e.path,re(),o));let x=!1;const F=async(s=!1)=>{var _;if(!s&&((_=a())!=null&&_.length))return;const Q=await q();se(Q,Y=>{x=!0,c(Y)},()=>{m()&&k()})},{isOpen:m,onToggle:k}=P(),O=()=>n()===e.path,T=ae(e.path);v(oe(n,async s=>{i&&T(s)&&(m()||k(),x||F())})),v(()=>{h()===e.path&&(m()||k(),x||F())});const J=()=>l(e.path)&&!T(n());return t(g,{get when(){return u||!J()},get children(){return t(y,{get children(){return[t(S,{spacing:"$2",get children(){return[t(g,{get when(){return!K()},get fallback(){return t(A,{size:"sm",get color(){return $()}})},get children(){return t(g,{get when(){return!G()},get fallback(){return t(w,{get color(){return $()},as:W})},get children(){return t(w,{get color(){return $()},as:be,get transform(){return m()?"rotate(90deg)":"none"},transition:"transform 0.2s",cursor:"pointer",onClick:()=>{k(),m()&&F()}})}})}}),t(le,{css:{whiteSpace:"nowrap"},fontSize:"$md",cursor:"pointer",px:"$1",rounded:"$md",get bgColor(){return O()?"$info8":"transparent"},get _hover(){return{bgColor:O()?"$info8":ie()}},onClick:()=>{d(e.path)},get children(){return I(()=>e.path==="/")()?"root":ce(e.path)}})]}}),t(g,{get when(){return m()},get children(){return t(ue,{mt:"$1",pl:"$4",alignItems:"start",spacing:"$1",get children(){return[t(de,{get each(){return a()},children:s=>t(j,{get path(){return U(e.path,s.name)}})}),t(g,{get when(){return h()===e.path},get children(){return t(Fe,{get parentPath(){return e.path},onCancel:()=>f(null),onSuccess:s=>{f(null),d(s),F(!0)}})}})]}})}})]}})}})},Se=0,Fe=e=>{const l=M(),[a,c]=b(""),[n,d]=R(ge),o=async()=>{const r=a().trim();if(!r||n())return;const u=fe(r);if(!u.valid){me.warning(l("global.".concat(u.error)));return}const h=U(e.parentPath,r),f=await d(h);Ce(f,()=>{e.onSuccess(h)},()=>{e.onCancel()})};let i;return he(()=>{setTimeout(()=>{i==null||i.focus(),i==null||i.select()},Se)}),t(S,{spacing:"$2",w:"$full",pl:"$4",alignItems:"center",get children(){return[t(w,{get color(){return $()},as:W}),t(z,{ref:r=>i=r,get value(){return a()},onInput:r=>c(r.currentTarget.value),get placeholder(){return l("home.toolbar.input_dir_name")},size:"sm",flex:"1",onKeyDown:r=>{r.key==="Enter"?(r.preventDefault(),o()):r.key==="Escape"&&e.onCancel()},onBlur:r=>{if(n())return;const u=r.relatedTarget;(u==null?void 0:u.dataset.folderAction)!=="true"&&(a().trim()||e.onCancel())}}),t(g,{get when(){return!n()},get fallback(){return t(A,{size:"sm",get color(){return $()}})},get children(){return t(C,{get"aria-label"(){return l("global.ok")},size:"sm",variant:"ghost",rounded:"$md",p:"$1",color:"$success9",onClick:o,tabIndex:0,"data-folder-action":"true",get children(){return t(w,{as:we,boxSize:"$6"})}})}}),t(C,{get"aria-label"(){return l("global.cancel")},size:"sm",variant:"ghost",rounded:"$md",p:"$1",color:"$danger9",get onClick(){return e.onCancel},tabIndex:0,"data-folder-action":"true",get children(){return t(w,{as:$e,boxSize:"$6"})}})]}})},xe=e=>{const l=M(),[a,c]=b("/"),[n,d]=b();return v(()=>{var o;e.opened&&((o=n())==null||o.setPath(a()))}),typeof e.defaultValue=="function"?v(()=>{c(e.defaultValue())}):typeof e.defaultValue=="string"&&c(e.defaultValue),t(D,{size:"xl",blockScrollOnMount:!1,get opened(){return e.opened},get onClose(){return e.onClose},get children(){return[t(E,{}),t(B,{get children(){return[t(H,{w:"$full",css:{overflowWrap:"break-word"},get children(){return t(S,{w:"$full",justifyContent:"space-between",alignItems:"center",get children(){return[t(y,{css:{overflowWrap:"break-word"},get children(){return e.header}}),t(g,{get when(){return I(()=>!!e.headerSlot)()&&n()},get children(){return e.headerSlot(n())}})]}})}}),t(N,{get children(){return[I(()=>e.children),t(L,{onChange:c,handle:o=>d(o),autoOpen:!0})]}}),t(V,{display:"flex",w:"$full",gap:"$4",alignItems:"flex-end",justifyContent:"flex-end",get children(){return[t(g,{get when(){return e.footerSlot},get children(){return t(y,{mr:"auto",get children(){return e.footerSlot}})}}),t(S,{spacing:"$2",get children(){return[t(C,{get onClick(){return e.onClose},colorScheme:"neutral",get children(){return l("global.cancel")}}),t(C,{get loading(){return e.loading},onClick:()=>{var o;return(o=e.onSubmit)==null?void 0:o.call(e,a())},get children(){return l("global.ok")}})]}})]}})]}})]}})},Ie=e=>{const{isOpen:l,onOpen:a,onClose:c}=P(),n=M();return[t(S,{w:"$full",spacing:"$2",get children(){return[t(z,{get id(){return e.id},get value(){return e.value},onInput:d=>e.onChange(d.currentTarget.value),get readOnly(){return e.onlyFolder},get onClick(){return e.onlyFolder?a:()=>{}},get placeholder(){return n("global.".concat(e.onlyFolder?"choose_folder":"choose_or_input_path"))}}),t(g,{get when(){return!e.onlyFolder},get children(){return t(C,{onClick:a,get children(){return n("global.choose")}})}})]}}),t(D,{size:"xl",get opened(){return l()},onClose:c,get children(){return[t(E,{}),t(B,{get children(){return[t(Z,{}),t(H,{get children(){return n("global.choose_folder")}}),t(N,{get children(){return t(L,{forceRoot:!0,get onChange(){return e.onChange}})}}),t(V,{get children(){return t(C,{onClick:c,get children(){return n("global.confirm")}})}})]}})]}})]};export{L as F,xe as M,Ie as a};
