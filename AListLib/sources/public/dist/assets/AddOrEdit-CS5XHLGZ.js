import{X as f,E as t,dK as p,ae as R,bU as ee,dL as te,b7 as H,B as ne,_ as re,dN as ae,T as le,aa as ie,ao as M,S as w,aE as P,aw as T,dO as ue,a6 as A,o as de,a1 as N,N as J,a7 as j,G as U,A as O,bt as L,aQ as ce,bW as D,q,as as G,aX as ge,aR as oe,aS as he,bu as se,aT as me,aU as fe,aW as ve,a8 as V,bE as ye,Z as be,$ as C,bo as B,bQ as Ce,bF as we,bX as Se,aJ as xe,bR as $e,k as _e,bq as W,bV as Te,c1 as Oe,W as ke,x as Ie,af as Fe,bT as Pe}from"./index-Bl5KfUKm.js";import{r as Me,g as Ee}from"./share-BJOZaU2H.js";import{T as l}from"./item_type-CyD6qwPS.js";import{R as Be}from"./ResponsiveGrid-BWMI6qdJ.js";import{o as Re,E as He,I as K,J as Ne,K as Le,n as Ve}from"./index-C_xnhf0Z.js";const Q=p(),qe=e=>{var a;const[d,n]=f("/");return(a=e.handle)==null||a.call(e,{setPath:n}),t(R,{class:"folder-tree-box",w:"$full",overflowX:"auto",get children(){return t(Q.Provider,{get value(){var i,s,v,g;return{value:d,onChange:u=>{n(u),e.onChange(u)},autoOpen:(i=e.autoOpen)!=null?i:!1,forceRoot:(s=e.forceRoot)!=null?s:!1,showEmptyIcon:(v=e.showEmptyIcon)!=null?v:!1,showHiddenFolder:(g=e.showHiddenFolder)!=null?g:!0}},get children(){return t(Z,{path:"/"})}})}})},Z=e=>{const{isHidePath:d}=ee(),[n,a]=f(),{value:i,onChange:s,forceRoot:v,autoOpen:g,showEmptyIcon:u,showHiddenFolder:y}=te(Q),S=()=>{var c;return!!(u&&n()!==void 0&&!((c=n())!=null&&c.length))},[x,k]=H(()=>ne(e.path,re(),1,0,!1));let I=!1;const _=async()=>{var $;if(($=n())!=null&&$.length)return;const c=await k();L(c,Y=>{I=!0,a(Y.content||[])},()=>{m()&&b()})},{isOpen:m,onToggle:b}=ze(),E=()=>i()===e.path,F=ae(e.path);le(ie(i,async c=>{g&&F(c)&&(m()||b(),I||_())}));const r=()=>d(e.path)&&!F(i()),h=()=>{var c;return((c=n())==null?void 0:c.filter($=>$.is_dir))||[]},X=()=>{var c;return((c=n())==null?void 0:c.filter($=>!$.is_dir))||[]};return t(w,{get when(){return y||!r()},get children(){return t(R,{get children(){return[t(M,{spacing:"$2",get children(){return[t(w,{get when(){return!x()},get fallback(){return t(ue,{size:"sm",get color(){return T()}})},get children(){return t(w,{get when(){return!S()},get fallback(){return t(P,{get color(){return T()},as:He})},get children(){return t(P,{get color(){return T()},as:Re,get transform(){return m()?"rotate(90deg)":"none"},transition:"transform 0.2s",cursor:"pointer",onClick:()=>{b(),m()&&_()}})}})}}),t(P,{get color(){return T()},as:K,cursor:"pointer"}),t(A,{css:{whiteSpace:"nowrap"},fontSize:"$md",cursor:"pointer",px:"$1",rounded:"$md",get bgColor(){return E()?"$info8":"transparent"},get _hover(){return{bgColor:E()?"$info8":J()}},onClick:()=>{s(e.path)},get children(){return N(()=>e.path==="/")()?"root":de(e.path)}})]}}),t(w,{get when(){return m()},get children(){return t(j,{mt:"$1",pl:"$4",alignItems:"start",spacing:"$1",get children(){return[t(U,{get each(){return h()},children:c=>t(Z,{get path(){return O(e.path,c.name)}})}),t(U,{get each(){return X()},children:c=>t(M,{spacing:"$2",w:"$full",get children(){return[t(R,{w:"16px"}),t(P,{get color(){return T()},as:Ne,cursor:"pointer"}),t(A,{css:{whiteSpace:"nowrap"},fontSize:"$md",cursor:"pointer",px:"$1",rounded:"$md",get bgColor(){return i()===O(e.path,c.name)?"$info8":"transparent"},get _hover(){return{bgColor:i()===O(e.path,c.name)?"$info8":J()}},onClick:()=>{s(O(e.path,c.name))},get children(){return c.name}})]}})})]}})}})]}})}})};function ze(){const[e,d]=f(!1);return{isOpen:e,onToggle:()=>d(!e()),onOpen:()=>d(!0),onClose:()=>d(!1)}}const Xe=e=>{const d=q(),{isOpen:n,onOpen:a,onClose:i}=ce(),[s,v]=f("/"),g=()=>{const u=e.value?e.value.split("\n"):[];let y=s();e.basePath&&(y=O(e.basePath,y));const S=[...u,y].filter(Boolean),x=[...new Set(S)];e.onChange(x.join("\n")),i()};return t(j,{w:"$full",spacing:"$2",alignItems:"stretch",get children(){return[t(M,{w:"$full",spacing:"$2",get children(){return[t(D,{get id(){return e.id},flex:"1",get value(){return e.value},get invalid(){return!e.valid},get readOnly(){return e.readOnly},get placeholder(){return e.placeholder||d("shares.files_placeholder")},onInput:u=>e.onChange(u.currentTarget.value)}),t(G,{colorScheme:"accent",get"aria-label"(){return d("global.choose_or_input_path")},get icon(){return t(K,{})},onClick:a,size:"lg",get disabled(){return e.readOnly}})]}}),t(ge,{size:"xl",get opened(){return n()},onClose:i,get children(){return[t(oe,{}),t(he,{get children(){return[t(se,{}),t(me,{get children(){return d("global.choose_or_input_path")}}),t(fe,{get children(){return t(qe,{forceRoot:!0,onChange:v,showHiddenFolder:!0})}}),t(ve,{display:"flex",gap:"$2",get children(){return[t(V,{onClick:i,colorScheme:"neutral",get children(){return d("global.cancel")}}),t(V,{onClick:g,colorScheme:"primary",get leftIcon(){return t(Le,{})},get children(){return d("shares.add_path")}})]}})]}})]}})]}})},o=e=>{const d=q();return t($e,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(ye,{get for(){return e.name},display:"flex",alignItems:"center",get children(){var n;return d((n=e.full_name_path)!=null?n:"shares.".concat(e.name))}}),t(be,{get fallback(){return t(xe,{get children(){return d("settings.unknown_type")}})},get children(){return[t(C,{get when(){return e.type===l.String},get children(){return t(M,{w:"$full",spacing:"$2",get children(){return[t(B,{get id(){return e.name},type:"text",get readOnly(){return e.readonly},get value(){return e.value},get invalid(){return!e.valid},get placeholder(){return e.placeholder},get onChange(){return e.type===l.String?n=>{var a;return(a=e.onChange)==null?void 0:a.call(e,n.currentTarget.value)}:void 0}}),t(w,{get when(){return N(()=>e.type===l.String)()&&e.random},get children(){return t(G,{colorScheme:"neutral","aria-label":"random",get icon(){return t(Ve,{})},get onClick(){return e.type===l.String?()=>{var n;return(n=e.onChange)==null?void 0:n.call(e,e.random())}:void 0}})}})]}})}}),t(C,{get when(){return e.type===l.Number},get children(){return t(B,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get invalid(){return!e.valid},get placeholder(){return e.placeholder},get onInput(){return e.type===l.Number?n=>{var a;return(a=e.onChange)==null?void 0:a.call(e,parseInt(n.currentTarget.value))}:void 0}})}}),t(C,{get when(){return e.type===l.Float},get children(){return t(B,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get invalid(){return!e.valid},get placeholder(){return e.placeholder},get onInput(){return e.type===l.Float?n=>{var a;return(a=e.onChange)==null?void 0:a.call(e,parseFloat(n.currentTarget.value))}:void 0}})}}),t(C,{get when(){return e.type===l.Bool},get children(){return t(Ce,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get invalid(){return!e.valid},get onChange(){return e.type===l.Bool?n=>{var a;return(a=e.onChange)==null?void 0:a.call(e,n.currentTarget.checked)}:void 0}})}}),t(C,{get when(){return e.type===l.Text},get children(){return t(D,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get invalid(){return!e.valid},get placeholder(){return e.placeholder},get onChange(){return e.type===l.Text?n=>{var a;return(a=e.onChange)==null?void 0:a.call(e,n.currentTarget.value)}:void 0}})}}),t(C,{get when(){return e.type===l.MultiPath},get children(){return t(Xe,{get id(){return e.name},get value(){return e.value},get valid(){return e.valid},get readOnly(){return e.readonly},get basePath(){return e.basePath},onChange:n=>{var a;e.type===l.MultiPath&&((a=e.onChange)==null||a.call(e,n))}})}}),t(C,{get when(){return e.type===l.Select},get children(){return t(we,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get invalid(){return!e.valid},get onChange(){return e.type===l.Select?n=>{var a;return(a=e.onChange)==null?void 0:a.call(e,n)}:void 0},get children(){return t(Se,{get readonly(){return e.readonly},get searchable(){return N(()=>e.type===l.Select)()&&e.searchable},get options(){return e.options.split(",").map(n=>{var a;return{key:n,label:d(((a=e.options_prefix)!=null?a:"shares.".concat(e.name,"s"))+".".concat(n))}})}})}})}})]}})]}})},De=()=>{const e=q(),{params:d,back:n,to:a}=_e(),{id:i}=d,[s,v]=H(()=>W.get("/share/get?id=".concat(i)),!0),[g,u]=Te({}),[y,S]=f(""),[x,k]=f(!1),[I,_]=f(""),[m,b]=f(!0);i&&(async()=>{const r=await v();L(r,h=>{Pe(()=>{u(h),S(h.files.join("\n")),h.expires&&_(new Date(h.expires).toLocaleString()),k(!0)})})})();const[F,z]=H(()=>W.post("/share/".concat(i?"update":"create"),g));return t(Fe,{get loading(){return i?s():!1},get children(){return[t(Oe,{mb:"$2",get children(){return e("global.".concat(i?"edit":"add"))}}),t(Be,{get children(){return[t(w,{when:i,get children(){return t(o,{name:"id",get type(){return l.String},value:i,valid:!0,readonly:!0})}}),t(o,{name:"files",get type(){return l.MultiPath},get value(){return y()},get valid(){return x()},get basePath(){return ke().base_path},required:!0,onChange:r=>{S(r),k(r.length>0),u("files",r.split("\n"))}}),t(o,{name:"remark",get type(){return l.Text},get value(){return g.remark},valid:!0,onChange:r=>{u("remark",r)}}),t(o,{name:"extract_folder",get type(){return l.Select},get value(){return g.extract_folder},valid:!0,options:"front,back",onChange:r=>{u("extract_folder",r)}}),t(o,{name:"order_by",get type(){return l.Select},get value(){return g.order_by},valid:!0,options:"name,size,modified",onChange:r=>{u("order_by",r)}}),t(o,{name:"order_direction",get type(){return l.Select},get value(){return g.order_direction},valid:!0,options:"asc,desc",onChange:r=>{u("order_direction",r)}}),t(o,{name:"pwd",get type(){return l.String},get value(){return g.pwd},valid:!0,onChange:r=>{u("pwd",r)},random:Me}),t(o,{name:"max_accessed",get type(){return l.Number},get value(){return g.max_accessed},valid:!0,onChange:r=>{u("max_accessed",r)}}),t(w,{when:i,get children(){return t(o,{name:"accessed",get type(){return l.Number},get value(){return g.accessed},valid:!0,onChange:r=>{u({...g,accessed:r})}})}}),t(o,{name:"expires",get type(){return l.String},get value(){return I()},get valid(){return m()},placeholder:"yyyy-MM-dd HH:mm:ss or +1w1d1H1m1s1ms",onChange:r=>{if(_(r),r===""){b(!0),u("expires",null);return}const h=Ee(r);isNaN(h.getTime())?b(!1):(b(!0),u("expires",h.toISOString()))}}),t(o,{name:"readme",get type(){return l.Text},get value(){return g.readme},valid:!0,onChange:r=>{u("readme",r)}}),t(o,{name:"header",get type(){return l.Text},get value(){return g.header},valid:!0,onChange:r=>{u("header",r)}})]}}),t(V,{mt:"$2",get disabled(){return!m()||!x()},get loading(){return F()},onClick:async()=>{const r=await z();L(r,()=>{Ie.success(e("global.save_success")),n()},(h,X)=>{r.data.id&&a("/@manage/shares/edit/".concat(r.data.id))})},get children(){return e("global.".concat(i?"save":"add"))}})]}})};export{De as default};
