import{k as fe,ac as Oe,b7 as ue,eh as Pe,ei as Me,C as y,X as c,T as de,U as k,an as Le,ej as b,E as t,P as Ie,J as T,K as W,a1 as z,G as ge,O as he,S as m,Z as Fe,$ as R,a0 as Ee,a6 as v,q as we,a7 as q,Y as Ue,aA as Ae,a2 as me,ao as S,bs as Be,af as Te,ds as We,ek as ze,bT as p,aE as be,aw as Re,r as qe,cE as De,cQ as Ne,N as Ge,am as He,bU as Je,cH as Ve,aI as Ke,aO as Qe,V as Xe,W as Ye,_ as D,aL as Ze}from"./index-Bl5KfUKm.js";import{O as et,g as tt}from"./icon-DqPtjxiZ.js";import{L as rt,c as _}from"./List-BSVXDida.js";import{d as nt,g as at}from"./index-C_xnhf0Z.js";import{g as it,O as st}from"./File-B_EEqmVs.js";import lt from"./Password-D5lAyFLG.js";import{u as ot}from"./helper-BVeNNIE1.js";import{b as ct,x as N,w as ut}from"./style-C2-n-Tf3.js";import"./Layout-CtHmJknm.js";import"./useTitle-COa73MJx.js";import"./FolderTree-CHsUuiQU.js";import"./index-BelfiY12.js";import"./ModalInput-CTZQE0yv.js";import"./index-fAEGil0n.js";import"./share-BJOZaU2H.js";import"./index-S6P6XS8L.js";import"./storage-B8Wc9tdG.js";function dt(){let a=!1,s=[];return{acquire:()=>new Promise(u=>{a?s.push(u):(a=!0,u())}),release:()=>{s.length>0?s.shift()():a=!1}}}const gt=a=>{window.open(a,"_blank")},ht=a=>{const{show:s}=ct({id:2}),{isMouseSupported:u}=ot(),i=()=>qe.list_item_filename_overflow;return t(He.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return t(S,{class:"list-item viselect-item",get"data-index"(){return a.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:Ge()}},get cursor(){return u()?"default":"pointer"},"on:click":f=>{a.obj.is_dir?a.jumpCallback():!a.obj.is_dir&&a.onFileClick&&a.onFileClick()},onContextMenu:f=>{s(f,{props:a})},get children(){return[t(S,{class:"name-box",spacing:"$1",get w(){return _[0].w},get children(){return[t(be,{class:"icon",boxSize:"$6",get color(){return Re()},get as(){return tt(a.obj)},mr:"$1"}),t(v,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:i()==="multi_line"?"unset":"nowrap","overflow-x":i()==="scrollable"?"auto":"hidden",textOverflow:i()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return a.obj.name},get children(){return a.obj.name}})]}}),t(v,{class:"size",get w(){return _[1].w},get textAlign(){return _[1].textAlign},get children(){return De(a.obj.size)}}),t(v,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return _[2].w},get textAlign(){return _[2].textAlign},get children(){return Ne(a.obj.modified)}})]}})}})},G={extract:{icon:at,color:"$success9"},copy_link:{icon:nt,color:"$info9"},download:{icon:Ze,color:"$primary9"}},mt=()=>{const{copy:a}=Je(),{colorMode:s}=Ve(),{isShare:u}=fe();return t(ut,{id:2,animation:"scale",get theme(){return s()!=="dark"?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[t(N,{hidden:({props:i})=>i.obj.is_dir,onClick:({props:i})=>{gt(i.url)},get children(){return t(H,{name:"download"})}}),t(N,{hidden:({props:i})=>i.obj.is_dir,onClick:({props:i})=>{a(i.url)},get children(){return t(H,{name:"copy_link"})}}),t(N,{hidden:()=>{const i=Qe.findIndex(f=>f==="decompress");return!u()&&!Xe.can(Ye(),i)},onClick:({props:i})=>{Ke.emit("extract",JSON.stringify({inner:i.innerPath,pass:i.pass}))},get children(){return t(H,{name:"extract"})}})]}})},H=a=>{const s=we();return t(S,{spacing:"$2",get children(){return[t(be,{get p(){return G[a.name].p?"$1":void 0},get as(){return G[a.name].icon},boxSize:"$7",get color(){return G[a.name].color}}),t(v,{get children(){return s("home.toolbar.".concat(a.name))}})]}})},It=()=>{const a=we(),{pathname:s}=fe(),{rawLink:u}=Oe(),[i,f]=ue(Pe),[pe,J]=ue(Me),ve=y(()=>i()||pe());let d="",V="",K="",x=null;const[O,$]=c(""),[ke,Q]=c(!1),[P,M]=c(!1),[X,_e]=c(""),[o,L]=c([]),[I,Y]=c(),[xe,Z]=c(!1),[$e,ee]=c(""),[g,te]=c(""),[re,ne]=c(""),h=dt(),j=e=>{let n={};return e.forEach(r=>{n[r.name]={...r,children:r.children?j(r.children):null}}),n},F=e=>e.code===200?!1:(e.code===202?p(()=>{d!==""&&Q(!0),M(!0),$("")}):$(e.message),!0),ae=async e=>{if(await h.acquire(),P()&&d==="")return h.release(),[];if(V===""){const r=await f(s(),D(),d);if(F(r))return h.release(),[];if(r.data.content!==null&&(x=j(r.data.content)),V=r.data.raw_url,K=r.data.sign,_e(r.data.comment),r.data.sort!==void 0){let l;r.data.sort.order_by!==""&&(l=r.data.sort.order_by);let w=r.data.sort.order_direction==="desc",Se=r.data.sort.extract_folder;p(()=>{Y(l),Z(w),ee(Se)})}if(r.data.encrypted&&d==="")return p(()=>{M(!0),$("")}),h.release(),[]}if(x===null){const r=await J(s(),D(),d,"/");if(F(r))return h.release(),[];x=j(r.data.content)}let n=x;for(let r=0;r<e.length;r++){if(n[e[r]].children===null){const l=await J(s(),D(),d,"/"+e.slice(0,r+1).join("/"));if(F(l))return h.release(),[];n[e[r]].children=j(l.data.content)}n=n[e[r]].children}return p(()=>{M(!1),Q(!1),$("")}),h.release(),Object.values(n)},[je,ie]=c([]);de(()=>{ae(o()).then(e=>ie(e))});const se=()=>{ae(o()).then(e=>ie(e))};se();const le=()=>{let e=je();I()&&(e=e.sort((r,l)=>(xe()?-1:1)*ze(r[I()],l[I()])));let n=$e();if(n!==""){let r=[],l=[];e.forEach(w=>(w.is_dir?r:l).push(w)),e=n==="front"?r.concat(l):l.concat(r)}return e},Ce=e=>(o().length>0?"/"+o().join("/"):"")+"/"+e,oe=e=>{const n=o().length>0?"/"+o().join("/"):"";return{...e,sign:K,inner_path:n,archive:B}},ye=(e,n)=>{p(()=>{ee(""),Y(e),n!==void 0&&Z(n)})},E=y(()=>le().filter(e=>!e.is_dir).map(e=>oe(e))),U=y(()=>{const e=E().find(n=>n.name===g());return e?it({...e,provider:k.provider}):[]}),A=y(()=>{const e=U();if(e.length===0)return null;if(re()){const n=e.find(r=>r.name===re());if(n)return n}return e[0]}),B={...k.obj,inner_path:void 0,archive:void 0},ce=k.raw_url,C=e=>{p(()=>{if(e==="")b.setObj(B),b.setRawUrl(ce),te("");else{const n=E().find(r=>r.name===e);if(n){const r=u(n);b.setObj(n),b.setRawUrl(r),te(e)}}})};return Le(()=>{b.setObj(B),b.setRawUrl(ce)}),de(()=>{g(),ne("")}),t(q,{spacing:"$2",w:"$full",get children(){return[t(Ie,{pl:"$2",pr:"$2",w:"$full",get children(){return[t(T,{get children(){return t(W,{get currentPage(){return z(()=>o().length===0)()&&!g()},"on:click":()=>{L([]),C("")},children:"."})}}),t(ge,{get each(){return o()},children:(e,n)=>t(T,{get children(){return[t(he,{}),t(W,{get currentPage(){return z(()=>o().length===n()+1)()&&!g()},"on:click":()=>{L(o().slice(0,n()+1)),C("")},children:e})]}})}),t(m,{get when(){return g()},get children(){return t(T,{get children(){return[t(he,{}),t(W,{currentPage:!0,get children(){return g()}})]}})}})]}}),t(Fe,{get children(){return[t(R,{get when(){return O()!==""},get children(){return t(Ee,{get msg(){return O()},disableColor:!0})}}),t(R,{get when(){return P()},get children(){return t(lt,{get title(){return a("home.toolbar.archive.input_password")},password:()=>d,setPassword:e=>d=e,enterCallback:()=>se(),get children(){return t(m,{get when(){return ke()},get children(){return t(v,{color:"$danger9",get children(){return a("home.toolbar.archive.incorrect_password")}})}})}})}}),t(R,{get when(){return z(()=>!P())()&&O()===""},get children(){return t(m,{get when(){return g()},get fallback(){return t(Te,{get loading(){return ve()},get children(){return t(q,{class:"list",w:"$full",spacing:"$1",get children(){return[t(rt,{sortCallback:ye,disableCheckbox:!0}),t(ge,{get each(){return le()},children:(e,n)=>{const r=oe(e);let l=e.is_dir?void 0:u(r),w=Ce(e.name);return t(ht,{obj:e,get index(){return n()},jumpCallback:()=>L(o().concat(e.name)),innerPath:w,url:l,pass:d,onFileClick:()=>C(e.name)})}}),t(mt,{})]}})}})},get children(){return t(m,{get when(){return g()},get fallback(){return t(me,{})},get children(){return t(q,{w:"$full",spacing:"$2",alignItems:"center",get children(){return[t(m,{get when(){return A()},get children(){return t(Ue,{get fallback(){return t(me,{})},get children(){return t(Ae,{get component(){var e;return(e=A())==null?void 0:e.component},get images(){return E().filter(e=>e.type===et.IMAGE)},navigate:e=>{C(e)}})}})}}),t(S,{w:"$full",justifyContent:"center",spacing:"$2",p:"$2",get children(){return[t(m,{get when(){return U().length>1},get children(){return t(Be,{get value(){var e;return((e=A())==null?void 0:e.name)||""},onChange:e=>ne(String(e)),get options(){return U().map(e=>({value:e.name,label:e.name}))}})}}),t(st,{get file(){return{name:g(),raw_url:k.raw_url,d_url:k.raw_url}}})]}})]}})}})}})}})]}}),t(m,{get when(){return X()!==""},get children(){return[t(We,{}),t(v,{w:"$full",pl:"$1",pr:"$1",get children(){return X()}})]}})]}})};export{It as default};
