import{E as t,bE as z,q as M,Z as K,$ as s,bo as x,bQ as U,bW as Y,bF as p,bX as ee,a1 as V,aJ as te,S as $,df as re,bR as ne,k as ae,b7 as f,bq as v,X as O,bV as R,C as ie,c1 as de,a7 as oe,dJ as ue,dg as ge,dh as le,G as E,F as q,ao as ce,a8 as _,x as y,L as se,bt as b,af as me}from"./index-Bl5KfUKm.js";import{M as A}from"./ModalInput-CTZQE0yv.js";import{T as d}from"./item_type-CyD6qwPS.js";import{R as he}from"./ResponsiveGrid-BWMI6qdJ.js";const k=e=>{const o=M(),g=i=>typeof i=="function"?i():i;return t(ne,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(z,{get for(){return e.name},display:"flex",alignItems:"center",get children(){var i;return o(((i=e.full_name_path)!=null?i:e.driver==="common")?"storages.common.".concat(e.name):"drivers.".concat(e.driver,".").concat(e.name))}}),t(K,{get fallback(){return t(te,{get children(){return o("settings.unknown_type")}})},get children(){return[t(s,{get when(){return e.type===d.String},get children(){return t(x,{get id(){return e.name},get type(){return e.name=="password"?"password":"text"},get readOnly(){return e.readonly},get value(){return g(e.value)},get onChange(){return e.type===d.String?i=>{var r;return(r=e.onChange)==null?void 0:r.call(e,i.currentTarget.value)}:void 0}})}}),t(s,{get when(){return e.type===d.Number},get children(){return t(x,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return g(e.value)},get onInput(){return e.type===d.Number?i=>{var r;return(r=e.onChange)==null?void 0:r.call(e,parseInt(i.currentTarget.value))}:void 0}})}}),t(s,{get when(){return e.type===d.Float},get children(){return t(x,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return g(e.value)},get onInput(){return e.type===d.Float?i=>{var r;return(r=e.onChange)==null?void 0:r.call(e,parseFloat(i.currentTarget.value))}:void 0}})}}),t(s,{get when(){return e.type===d.Bool},get children(){return t(U,{get id(){return e.name},get readOnly(){return e.readonly},get checked(){return g(e.value)},get onChange(){return e.type===d.Bool?i=>{var r;return(r=e.onChange)==null?void 0:r.call(e,i.currentTarget.checked)}:void 0}})}}),t(s,{get when(){return e.type===d.Text},get children(){return t(Y,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return g(e.value)},get onChange(){return e.type===d.Text?i=>{var r;return(r=e.onChange)==null?void 0:r.call(e,i.currentTarget.value)}:void 0}})}}),t(s,{get when(){return e.type===d.Select},get children(){return t(p,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return g(e.value)},get onChange(){return e.type===d.Select?i=>{var r;return(r=e.onChange)==null?void 0:r.call(e,i)}:void 0},get children(){return t(ee,{get readonly(){return e.readonly},get searchable(){return V(()=>e.type===d.Select)()&&e.searchable},get options(){return e.options.split(",").map(i=>{var r;return{key:i,label:o(((r=e.options_prefix)!=null?r:e.driver==="common"?"storages.common.".concat(e.name,"s"):"drivers.".concat(e.driver,".").concat(e.name,"s"))+".".concat(i))}})}})}})}})]}}),t($,{get when(){return e.help},get children(){return t(re,{get children(){return o(e.driver==="common"?"storages.common.".concat(e.name,"-tips"):"drivers.".concat(e.driver,".").concat(e.name,"-tips"))}})}})]}})};function B(e,o){switch(e){case d.Bool:return o?o==="true":!1;case d.Number:return o?parseInt(o):0;case d.Float:return o?parseFloat(o):0;default:return o||""}}const Se=()=>{const e=M(),{params:o,back:g,to:i}=ae(),{id:r}=o,[j,D]=f(()=>v.get("/admin/driver/list"),!0),[l,F]=O({}),G=async()=>{const n=await D();b(n,F)},[H,X]=f(()=>v.get("/admin/storage/get?id=".concat(r)),!0),[P,Q]=f(()=>v.get("/admin/driver/info?driver=".concat(u.driver)),!0);r?(async()=>{const n=await X();b(n,async a=>{c(a),m(JSON.parse(a.addition));const h=await Q();b(h,J=>F({[u.driver]:J}))})})():G();const[u,c]=R({}),[T,m]=R({}),[w,W]=f(()=>(c("addition",JSON.stringify(T)),v.post("/admin/storage/".concat(r?"update":"create"),u))),I=ie(()=>{var a;const n=(a=l()[u.driver])==null?void 0:a.config.alert;if(console.log(n),n)return n.split("|")[0]}),[N,S]=O(!1),[Z,C]=O(!1);return t(me,{get loading(){return r?H()||P():j()},get children(){return[t(de,{mb:"$2",get children(){return e("global.".concat(r?"edit":"add"))}}),t(oe,{mb:"$2",spacing:"$2",get children(){return[t(k,{name:"driver",default:"",readonly:r!==void 0,required:!0,searchable:!0,get type(){return d.Select},get options(){return r?u.driver:Object.keys(l()).join(",")},get value(){return u.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:n=>{for(const a of l()[n].common)c(a.name,B(a.type,a.default));m(ue(a=>{for(const h in a)delete a[h]}));for(const a of l()[n].additional)m(a.name,B(a.type,a.default));c("driver",n)}}),t($,{get when(){return I()},get children(){return t(ge,{get status(){return I()},w:"$full",get children(){return[t(le,{}),V(()=>e("drivers.config.".concat(u.driver,".alert")))]}})}})]}}),t(he,{get children(){return t($,{get when(){return l()[u.driver]},get children(){return[t(E,{get each(){return l()[u.driver].common},children:n=>t(k,q(n,{driver:"common",get value(){return u[n.name]},onChange:a=>{c(n.name,a)}}))}),t(E,{get each(){return l()[u.driver].additional},children:n=>t(k,q(n,{get driver(){return u.driver},get value(){return T[n.name]},onChange:a=>{m(n.name,a)}}))})]}})}}),t(ce,{mt:"$2",spacing:"$2",gap:"$2",w:"$full",wrap:{"@initial":"wrap","@md":"unset"},get children(){return[t(_,{get loading(){return w()},onClick:async()=>{l()[u.driver].config.need_ms&&(y.info(e("manage.add_storage-tips")),window.open(se("/@manage/messenger"),"_blank"));const n=await W();b(n,()=>{y.success(e("global.save_success")),g()},(a,h)=>{n.data.id&&i("/@manage/storages/edit/".concat(n.data.id))})},get children(){return e("global.".concat(r?"save":"add"))}}),t(_,{colorScheme:"accent",get loading(){return w()},onClick:async()=>{S(!0)},get children(){return e("storages.common.export")}}),t(_,{colorScheme:"primary",get loading(){return w()},onClick:async()=>{C(!0)},get children(){return e("storages.common.import")}})]}}),t($,{get when(){return N()},get children(){return t(A,{get opened(){return N()},onClose:()=>S(!1),get title(){return e("storages.common.export_title")},type:"text",get tips(){return e("storages.common.export_tips")},get defaultValue(){return JSON.stringify(u)},onSubmit:()=>{S(!1)}})}}),t(A,{get opened(){return Z()},onClose:()=>C(!1),get title(){return e("storages.common.import_title")},type:"text",get tips(){return e("storages.common.import_tips")},onSubmit:n=>{try{const{id:a,disabled:h,modified:J,status:ve,...L}=JSON.parse(n);c(L),m(JSON.parse(L.addition)),C(!1),y.success(e("storages.common.import_success"))}catch(a){y.error("Invalid storage format: ".concat(a.message))}}})]}})};export{Se as default};
