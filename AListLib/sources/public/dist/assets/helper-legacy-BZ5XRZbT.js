System.register(["./index-legacy-BzvznpU_.js","./Paginator-legacy-CZo-P87F.js"],function(e,t){"use strict";var r,n,a,l,s,o,c,i,d,u,g,h,p,m,w,$,f,k,v,x,y,_,b,S,C,z,A,T,B,F,P,R,D,E,I,O,j,q,G;return{setters:[e=>{r=e.W,n=e.b7,a=e.bq,l=e.X,s=e.E,o=e.ao,c=e.ba,i=e.c1,d=e.S,u=e.aJ,g=e.cF,h=e.cG,p=e.a6,m=e.c0,w=e.dp,$=e.a8,f=e.q,k=e.bt,v=e.x,x=e.a1,y=e.a7,_=e.dq,b=e.dr,S=e.G,C=e.ds,z=e.cD,A=e.C,T=e.an,B=e.T,F=e.bo,P=e.F,R=e.bT,D=e.ap,E=e.aV,I=e.cp,O=e.dt,j=e.cq,q=e.du},e=>{G=e.P}],execute:function(){const t={7:"danger",2:"success",4:"neutral"},W=e=>{if(e.role<0)return null;const t=["info","neutral","accent"];return s(z,{get colorScheme(){return t[e.role]},css:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},get children(){return e.name}})},L=e=>{const r=f();return s(z,{get colorScheme(){return t[e.state]??"info"},get children(){return r(`tasks.state.${e.state}`)}})},M=[{name:"name",textAlign:"left",w:2===r().role?"calc(100% - 660px)":"calc(100% - 560px)"},{name:"creator",textAlign:"center",w:2===r().role?"100px":"0"},{name:"state",textAlign:"center",w:"100px"},{name:"progress",textAlign:"left",w:"140px"},{name:"speed",textAlign:"center",w:"100px"},{name:"operation",textAlign:"right",w:"220px"}],X=e=>Math.floor(e).toString().padStart(2,"0"),J=e=>{const t=f(),z="undone"===e.done?"cancel":"delete",A="done"===e.done&&(7===e.state||4===e.state),[T,B]=n(()=>a.post(`/task/${e.type}/${z}?tid=${e.id}`)),[F,P]=n(()=>a.post(`/task/${e.type}/retry?tid=${e.id}`)),[R,D]=l(!1),E=e.name.match(e.nameAnalyzer.regex),I=null===E?e.name:e.nameAnalyzer.title(E),O=null===e.start_time?-1:new Date(e.start_time).getTime(),j=null===e.end_time?(new Date).getTime():new Date(e.end_time).getTime();let q="-";const G=(e,t)=>{let r=t/e;const n=["B/s","KiB/s","MiB/s","GiB/s","TiB/s","PiB/s","EiB/s"];let a=0;for(;a<n.length-1&&r>=1024;)r/=1024,a++;return`${r.toFixed(2)} ${n[a]}`};if(e.done){if(e.start_time!==e.end_time&&e.progress>0&&-1!==O){const t=(j-O)/1e3,r=e.total_bytes*e.progress/100;q=G(t,r)}}else if(void 0!==e.prevProgress&&void 0!==e.prevFetchTime){const t=(e.curFetchTime-e.prevFetchTime)/1e3,r=(e.progress-e.prevProgress)*e.total_bytes/100;q=G(t,r)}return s(d,{get when(){return!R()},get children(){return[s(o,{w:"$full",p:"$2",get children(){return[s(o,{get w(){return M[0].w},spacing:"$1",get children(){return[s(c,{"on:click":e=>{e.stopPropagation()},get checked(){return e.local.selected},onChange:t=>{e.setLocal({selected:t.target.checked,expanded:e.local.expanded})}}),s(i,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:I})]}}),s(d,{get when(){return 2===r().role},get children(){return s(u,{get w(){return M[1].w},get children(){return s(W,{get name(){return e.creator},get role(){return e.creator_role}})}})}}),s(u,{get w(){return M[2].w},get children(){return s(L,{get state(){return e.state}})}}),s(g,{get w(){return M[3].w},trackColor:"$info3",rounded:"$full",size:"sm",get value(){return e.progress},mr:"$1",get children(){return s(h,{color:"$info8",rounded:"$md"})}}),s(u,{get w(){return M[1].w},get children(){return s(p,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:q})}}),s(m,{get w(){return M[5].w},gap:"$1",get children(){return[s(w,{}),s(d,{get when(){return e.canRetry},get children(){return s($,{size:"sm",disabled:!A,display:A?"block":"none",get loading(){return F()},onClick:async()=>{const e=await P();k(e,()=>{v.info(t("tasks.retry")),D(!0)})},get children(){return t("tasks.retry")}})}}),s($,{size:"sm",colorScheme:"danger",get loading(){return T()},onClick:async()=>{const e=await B();k(e,()=>{v.success(t("global.delete_success")),D(!0)})},get children(){return t(`global.${z}`)}}),s($,{size:"sm",colorScheme:"neutral",onClick:()=>{e.setLocal({selected:e.local.selected,expanded:!e.local.expanded})},get children(){return x(()=>!!e.local.expanded)()?t("tasks.fold"):t("tasks.expand")}})]}})]}}),s(d,{get when(){return e.local.expanded},get children(){return s(y,{css:{wordBreak:"break-all",fontSize:"0.8em"},w:"$full",pl:"$2",pr:"$2",get children(){return[s(_,{templateColumns:"min-content 1fr",w:"$full",columnGap:"$4",mb:"$2",get children(){return[s(d,{when:-1!==O,get children(){return[s(b,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return t("tasks.attr.time_elapsed")}}),s(b,{color:"$neutral9",get children(){return(e=>{const t=e/1e3%60,r=e/1e3/60%60;return`${X(e/1e3/3600)}:${X(r)}:${X(t)}`})(j-O)}})]}}),s(d,{when:null!==E,get children(){return s(S,{get each(){return Object.entries(e.nameAnalyzer.attrs)},children:e=>{const t=e[1](E);return void 0===t?null:s(d,{get when(){return void 0!==e[1]},get children(){return[s(b,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return e[0]}}),s(b,{color:"$neutral9",children:t})]}})}})}}),s(b,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return t("tasks.attr.status")}}),s(b,{color:"$neutral9",get children(){return e.status}}),s(d,{get when(){return e.error},get children(){return[s(b,{color:"$danger9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return t("tasks.attr.err")}}),s(b,{color:"$danger9",get children(){return e.error}})]}})]}}),s(C,{})]}})}})]}})},K=e=>{const t=f(),[u,g]=n(()=>a.get(`/task/${e.type}/${e.done}`)),[h,_]=l([]),[b,S]=l("name"),[C,z]=l(!1),D={name:(e,t)=>e.name>t.name?1:-1,creator:(e,t)=>e.creator===t.creator?e.id>t.id?1:-1:e.creator>t.creator?1:-1,state:(e,t)=>e.state===t.state?e.id>t.id?1:-1:e.state>t.state?1:-1,progress:(e,t)=>e.progress===t.progress?e.id>t.id?1:-1:e.progress<t.progress?1:-1},E=A(()=>(e,t)=>(C()?-1:1)*D[b()](e,t)),I=async()=>{const e=await g();k(e,e=>{const t=(new Date).getTime(),r={},n={},a={},l={},s={};for(const o of h())r[o.id]=o.curFetchTime,n[o.id]=o.prevFetchTime,a[o.id]=o.progress,l[o.id]=o.prevProgress,s[o.id]=o.local;_(e?.map(e=>{let o,c;e.progress===a[e.id]?(o=n[e.id],c=l[e.id]):(o=r[e.id],c=a[e.id]);const i=s[e.id]??{selected:!1,expanded:!1};return{...e,curFetchTime:t,prevFetchTime:o,prevProgress:c,local:i}}).sort(E())??[])})};if(I(),"undone"===e.done){const e=setInterval(I,2e3);T(()=>clearInterval(e))}const[O,j]=n(()=>a.post(`/task/${e.type}/clear_done`)),[q,W]=n(()=>a.post(`/task/${e.type}/clear_succeeded`)),[L,X]=n(()=>a.post(`/task/${e.type}/retry_failed`)),[K,V]=l(""),[H,N]=l(new RegExp("")),[Q,U]=l(!1);B(()=>{try{N(new RegExp(K())),U(!1)}catch(e){U(!0)}});const[Y,Z]=l(2!==r().role),ee=A(()=>{const e=H(),t=Y();return n=>e.test(n.name)&&(!t||n.creator===r().username)}),te=A(()=>h().filter(ee())),re=A(()=>te().map(e=>e.local.selected).every(Boolean)),ne=A(()=>te().map(e=>e.local.selected).some(Boolean)&&!re()),ae=A(()=>te().map(e=>e.local.expanded).every(Boolean)),le=()=>te().filter(e=>e.local.selected).map(e=>e.id),[se,oe]=n(()=>a.post(`/task/${e.type}/retry_some`,le())),[ce,ie]=n(()=>a.post(`/task/${e.type}/${he}_some`,le())),de=e=>{Object.entries(e).forEach(([e,t])=>{v.error(`${e}: ${t}`)})},[ue,ge]=l(1),he="undone"===e.done?"cancel":"delete",pe=A(()=>{const e=20*(ue()-1),t=e+20;return te().slice(e,t)}),me=e=>({fontWeight:"bold",fontSize:"$sm",color:"$neutral11",textAlign:e.textAlign}),we=e=>({cursor:"pointer",onClick:()=>{b()===e.name?z(!C()):R(()=>{S(e.name),z(!1)}),I()}});return s(y,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[s(i,{size:"lg",get children(){return t(`tasks.${e.done}`)}}),s(o,{gap:"$2",flexWrap:"wrap",get children(){return[s(d,{get when(){return"done"===e.done},get children(){return[s($,{colorScheme:"accent",get loading(){return u()},onClick:I,get children(){return t("global.refresh")}}),s($,{get loading(){return L()},onClick:async()=>{const e=await X();k(e,()=>I())},get children(){return t("tasks.retry_failed")}}),s($,{colorScheme:"danger",get loading(){return O()},onClick:async()=>{const e=await j();k(e,()=>I())},get children(){return t("global.clear")}}),s($,{colorScheme:"success",get loading(){return q()},onClick:async()=>{const e=await W();k(e,()=>I())},get children(){return t("tasks.clear_succeeded")}})]}}),s(d,{get when(){return e.canRetry},get children(){return s($,{colorScheme:"primary",get loading(){return se()},onClick:async()=>{const e=await oe();k(e,e=>{de(e),I()})},get children(){return t("tasks.retry_selected")}})}}),s($,{colorScheme:"warning",get loading(){return ce()},onClick:async()=>{const e=await ie();k(e,e=>{de(e),I()})},get children(){return t(`tasks.${he}_selected`)}}),s(F,{width:"auto",get placeholder(){return t("tasks.filter")},get value(){return K()},onInput:e=>V(e.target.value),get invalid(){return Q()}}),s(d,{get when(){return 2===r().role},get children(){return s(c,{get checked(){return Y()},onChange:e=>Z(e.target.checked),get children(){return t("tasks.show_only_mine")}})}})]}}),s(y,{w:{"@initial":"1024px","@lg":"$full"},overflowX:"auto",shadow:"$md",rounded:"$lg",spacing:"$1",p:"$1",get children(){return[s(o,{class:"title",w:"$full",p:"$2",get children(){return[s(o,{get w(){return M[0].w},spacing:"$1",get children(){return[s(c,{get disabled(){return 0===te().length},get checked(){return re()},get indeterminate(){return ne()},onChange:e=>{return t=e.target.checked,_(h().map(e=>(ee()(e)&&(e.local.selected=t),e)));var t}}),s(p,P(()=>me(M[0]),()=>we(M[0]),{get children(){return t(`tasks.attr.${M[0].name}`)}}))]}}),s(d,{get when(){return 2===r().role},get children(){return s(p,P({get w(){return M[1].w}},()=>me(M[1]),()=>we(M[1]),{get children(){return t(`tasks.attr.${M[1].name}`)}}))}}),s(p,P({get w(){return M[2].w}},()=>me(M[2]),()=>we(M[2]),{get children(){return t(`tasks.attr.${M[2].name}`)}})),s(p,P({get w(){return M[3].w}},()=>me(M[3]),()=>we(M[3]),{get children(){return t(`tasks.attr.${M[3].name}`)}})),s(p,P({get w(){return M[4].w}},()=>me(M[4]),{get children(){return t(`tasks.attr.${M[4].name}`)}})),s(m,{get w(){return M[5].w},gap:"$2",get children(){return[s(w,{}),s(p,P(()=>me(M[5]),{get children(){return t(`tasks.attr.${M[5].name}`)}})),s($,{size:"xs",colorScheme:"neutral",onClick:()=>{return e=!ae(),_(h().map(t=>(ee()(t)&&(t.local.expanded=e),t)));var e},get disabled(){return 0===te().length},get children(){return x(()=>!!ae())()?t("tasks.fold_all"):t("tasks.expand_all")}})]}})]}}),x(()=>pe().map(t=>s(J,P(t,e,{get setLocal(){return e=t.id,t=>_(h().map(r=>(r.id===e&&(r.local=t),r)));var e}}))))]}}),s(G,{get total(){return te().length},defaultPageSize:20,onChange:e=>{ge(e)}})]}})};e("T",e=>{const t=f();return s(y,{w:"$full",alignItems:"start",spacing:"$4",get children(){return[s(i,{size:"xl",get children(){return t(`tasks.${e.type}`)}}),s(y,{w:"$full",spacing:"$2",get children(){return s(S,{each:["undone","done"],children:t=>s(K,{get type(){return e.type},done:t,get canRetry(){return e.canRetry},get nameAnalyzer(){return e.nameAnalyzer}})})}})]}})});var V=D("<a>"),H=D("<p>"),N=D("<a target=_blank>");const Q=e("b",(e,t,n=!0)=>{const a=("/"===e?"":e)+t,s="/"===r().base_path?"":r().base_path,o=a.startsWith(s),[c,i]=l(!1);return o&&n?((u=V()).$$mouseout=()=>i(!1),u.$$mouseover=()=>i(!0),E(u,a),I(e=>{var t=c()?"text-decoration: underline":"",r=a.slice(s.length);return e.e=O(u,t,e.e),r!==e.t&&j(u,"href",e.t=r),e},{e:void 0,t:void 0}),u):(d=H(),E(d,a),d);var d,u});e("g",()=>{const e=f(),[t,r]=l(!1);return{regex:/^download (.+) to \((.+)\)$/,title:e=>e[1],attrs:{[e("tasks.attr.offline_download.url")]:e=>{return(n=N()).$$mouseout=()=>r(!1),n.$$mouseover=()=>r(!0),E(n,()=>e[1]),I(r=>{var a=t()?"text-decoration: underline":"",l=e[1];return r.e=O(n,a,r.e),l!==r.t&&j(n,"href",r.t=l),r},{e:void 0,t:void 0}),n;var n},[e("tasks.attr.offline_download.path")]:e=>Q("",e[2])}}}),e("a",()=>{const e=f(),[t,r]=l(!1);return{regex:/^(transfer|upload) \[(.*)]\((.*\/([^\/]+))\) to \[(.+)]\((.+)\)$/,title:e=>"upload"===e[1]?e[2]:e[4],attrs:{[e("tasks.attr.offline_download.transfer_src")]:e=>"transfer"!==e[1]||""===e[2]?void 0:Q(e[2],e[3]),[e("tasks.attr.offline_download.transfer_src_local")]:e=>""===e[2]?e[3]:void 0,[e("tasks.attr.offline_download.url")]:e=>{return"upload"===e[1]?((n=N()).$$mouseout=()=>r(!1),n.$$mouseover=()=>r(!0),E(n,()=>e[3]),I(r=>{var a=t()?"text-decoration: underline":"",l=e[3];return r.e=O(n,a,r.e),l!==r.t&&j(n,"href",r.t=l),r},{e:void 0,t:void 0}),n):void 0;var n},[e("tasks.attr.offline_download.transfer_dst")]:e=>Q(e[5],e[6])}}}),e("c",()=>{const e=f();return{regex:/^decompress \[(.+)]\((.*\/([^\/]+))\)\[(.+)] to \[(.+)]\((.+)\) with password <(.*)>$/,title:e=>e[3],attrs:{[e("tasks.attr.decompress.src")]:e=>Q(e[1],e[2]),[e("tasks.attr.decompress.dst")]:e=>Q(e[5],e[6]),[e("tasks.attr.decompress.inner")]:e=>{return t=H(),E(t,()=>e[4]),t;var t},[e("tasks.attr.decompress.password")]:e=>{return t=H(),E(t,()=>e[7]),t;var t}}}}),e("d",()=>{const e=f();return{regex:/^upload (.+) to \[(.+)]\((.+)\)$/,title:e=>e[1],attrs:{[e("tasks.attr.decompress.dst")]:e=>Q(e[2],e[3])}}}),q(["mouseover","mouseout"])}}});
